<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Upload & Gallery</title>
</head>

<body>
  <div class="container">
    <header>
      <h1>Photo Gallery</h1>
      <button id="refreshBtn" onclick="loadGallery()">Refresh</button>
    </header>
    <div id="gallery" class="gallery-grid"></div>
    <div id="status" class="status-message"></div>
  </div>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify_content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    h1 {
      margin: 0;
      font-size: 2rem;
      color: #2c3e50;
    }

    button {
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #0056b3;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }

    .gallery-item {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }

    .gallery-item:hover {
      transform: translateY(-5px);
    }

    .gallery-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .gallery-item .caption {
      padding: 10px;
      font-size: 0.85rem;
      color: #666;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .status-message {
      text-align: center;
      margin-top: 20px;
      color: #666;
    }
  </style>

  <script>
    const gallery = document.getElementById("gallery");
    const statusDiv = document.getElementById("status");

    async function loadGallery() {
      statusDiv.textContent = "Loading...";
      try {
        const res = await fetch("/dyatel/photos");
        if (!res.ok) throw new Error("Failed to fetch photos");
        const data = await res.json();

        gallery.innerHTML = "";

        // Sort photos by filename (timestamp) descending (newest first)
        data.photos.sort((a, b) => {
          const nameA = a.split('/').pop();
          const nameB = b.split('/').pop();
          // Assuming filenames are timestamps, string comparison works for same length
          // Descending order (Newest first)
          if (nameA > nameB) return -1;
          if (nameA < nameB) return 1;
          return 0;
        });

        if (data.photos.length === 0) {
          statusDiv.textContent = "No photos found.";
          return;
        }

        data.photos.forEach(url => {
          const item = document.createElement("div");
          item.className = "gallery-item";

          const img = document.createElement("img");
          img.src = url;
          img.loading = "lazy";

          const caption = document.createElement("div");
          caption.className = "caption";
          // Extract filename from URL for caption
          caption.textContent = url.split('/').pop();

          item.appendChild(img);
          item.appendChild(caption);
          gallery.appendChild(item);
        });
        statusDiv.textContent = "";
      } catch (err) {
        console.error(err);
        statusDiv.textContent = "Error loading gallery. Please try again.";
      }
    }

    // Load on start
    loadGallery();

    // Auto-refresh every 30 seconds (optional, user didn't ask but good for "viewing" use case)
    setInterval(loadGallery, 30000);
  </script>
</body>

</html>